<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>components\form-widget.js - Featherbone Client</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="..\..\featherbone-client.png" title="Featherbone Client"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Catalog.html">Catalog</a></li>
                                <li><a href="../classes/Components.AccountMenu.html">Components.AccountMenu</a></li>
                                <li><a href="../classes/Components.AddressRelation.html">Components.AddressRelation</a></li>
                                <li><a href="../classes/Components.AutoNumber.html">Components.AutoNumber</a></li>
                                <li><a href="../classes/Components.Button.html">Components.Button</a></li>
                                <li><a href="../classes/Components.Checkbox.html">Components.Checkbox</a></li>
                                <li><a href="../classes/Components.ChildFormPage.html">Components.ChildFormPage</a></li>
                                <li><a href="../classes/Components.ChildTable.html">Components.ChildTable</a></li>
                                <li><a href="../classes/Components.ContactRelation.html">Components.ContactRelation</a></li>
                                <li><a href="../classes/Components.DataList.html">Components.DataList</a></li>
                                <li><a href="../classes/Components.DataType.html">Components.DataType</a></li>
                                <li><a href="../classes/Components.Dialog.html">Components.Dialog</a></li>
                                <li><a href="../classes/Components.FilterDialog.html">Components.FilterDialog</a></li>
                                <li><a href="../classes/Components.FormDialog.html">Components.FormDialog</a></li>
                                <li><a href="../classes/Components.FormPage.html">Components.FormPage</a></li>
                                <li><a href="../classes/Components.FormWidget.html">Components.FormWidget</a></li>
                                <li><a href="../classes/Components.MoneyRelation.html">Components.MoneyRelation</a></li>
                                <li><a href="../classes/Components.NavigatorMenu.html">Components.NavigatorMenu</a></li>
                                <li><a href="../classes/Components.RelationWidget.html">Components.RelationWidget</a></li>
                                <li><a href="../classes/Components.SearchInput.html">Components.SearchInput</a></li>
                                <li><a href="../classes/Components.SearchPage.html">Components.SearchPage</a></li>
                                <li><a href="../classes/Components.SettingsPage.html">Components.SettingsPage</a></li>
                                <li><a href="../classes/Components.SortDialog.html">Components.SortDialog</a></li>
                                <li><a href="../classes/Components.TableDialog.html">Components.TableDialog</a></li>
                                <li><a href="../classes/Components.TableWidget.html">Components.TableWidget</a></li>
                                <li><a href="../classes/Components.WorkbookPage.html">Components.WorkbookPage</a></li>
                                <li><a href="../classes/Datasource.html">Datasource</a></li>
                                <li><a href="../classes/f.html">f</a></li>
                                <li><a href="../classes/List.html">List</a></li>
                                <li><a href="../classes/Model.html">Model</a></li>
                                <li><a href="../classes/Models.Address.html">Models.Address</a></li>
                                <li><a href="../classes/Models.BaseCurrency.html">Models.BaseCurrency</a></li>
                                <li><a href="../classes/Models.Comment.html">Models.Comment</a></li>
                                <li><a href="../classes/Models.Contact.html">Models.Contact</a></li>
                                <li><a href="../classes/Models.ContactAddress.html">Models.ContactAddress</a></li>
                                <li><a href="../classes/Models.ContactEmail.html">Models.ContactEmail</a></li>
                                <li><a href="../classes/Models.ContactPhone.html">Models.ContactPhone</a></li>
                                <li><a href="../classes/Models.ContactSocialAccount.html">Models.ContactSocialAccount</a></li>
                                <li><a href="../classes/Models.Country.html">Models.Country</a></li>
                                <li><a href="../classes/Models.Currency.html">Models.Currency</a></li>
                                <li><a href="../classes/Models.CurrencyConversion.html">Models.CurrencyConversion</a></li>
                                <li><a href="../classes/Models.CurrencyUnit.html">Models.CurrencyUnit</a></li>
                                <li><a href="../classes/Models.CurrencyUnitConversion.html">Models.CurrencyUnitConversion</a></li>
                                <li><a href="../classes/Models.DataListOption.html">Models.DataListOption</a></li>
                                <li><a href="../classes/Models.DataService.html">Models.DataService</a></li>
                                <li><a href="../classes/Models.Document.html">Models.Document</a></li>
                                <li><a href="../classes/Models.Feather.html">Models.Feather</a></li>
                                <li><a href="../classes/Models.FeatherAuthorization.html">Models.FeatherAuthorization</a></li>
                                <li><a href="../classes/Models.FeatherOverload.html">Models.FeatherOverload</a></li>
                                <li><a href="../classes/Models.FeatherProperty.html">Models.FeatherProperty</a></li>
                                <li><a href="../classes/Models.Form.html">Models.Form</a></li>
                                <li><a href="../classes/Models.FormAttr.html">Models.FormAttr</a></li>
                                <li><a href="../classes/Models.FormAttrColumn.html">Models.FormAttrColumn</a></li>
                                <li><a href="../classes/Models.FormTab.html">Models.FormTab</a></li>
                                <li><a href="../classes/Models.Honorific.html">Models.Honorific</a></li>
                                <li><a href="../classes/Models.Kind.html">Models.Kind</a></li>
                                <li><a href="../classes/Models.Layout.html">Models.Layout</a></li>
                                <li><a href="../classes/Models.Log.html">Models.Log</a></li>
                                <li><a href="../classes/Models.Module.html">Models.Module</a></li>
                                <li><a href="../classes/Models.ModuleDependency.html">Models.ModuleDependency</a></li>
                                <li><a href="../classes/Models.Object.html">Models.Object</a></li>
                                <li><a href="../classes/Models.ObjectAuthorization.html">Models.ObjectAuthorization</a></li>
                                <li><a href="../classes/Models.RelationSearchColumn.html">Models.RelationSearchColumn</a></li>
                                <li><a href="../classes/Models.RelationWidget.html">Models.RelationWidget</a></li>
                                <li><a href="../classes/Models.Role.html">Models.Role</a></li>
                                <li><a href="../classes/Models.RoleMembership.html">Models.RoleMembership</a></li>
                                <li><a href="../classes/Models.Route.html">Models.Route</a></li>
                                <li><a href="../classes/Models.Script.html">Models.Script</a></li>
                                <li><a href="../classes/Models.SocialNetwork.html">Models.SocialNetwork</a></li>
                                <li><a href="../classes/Models.State.html">Models.State</a></li>
                                <li><a href="../classes/Models.Style.html">Models.Style</a></li>
                                <li><a href="../classes/Models.Unit.html">Models.Unit</a></li>
                                <li><a href="../classes/Models.UserAccount.html">Models.UserAccount</a></li>
                                <li><a href="../classes/Models.Workbook.html">Models.Workbook</a></li>
                                <li><a href="../classes/Models.WorkbookAuthorization.html">Models.WorkbookAuthorization</a></li>
                                <li><a href="../classes/Models.WorkbookChild.html">Models.WorkbookChild</a></li>
                                <li><a href="../classes/Models.WorkbookDefaultConfig.html">Models.WorkbookDefaultConfig</a></li>
                                <li><a href="../classes/Models.WorkbookLocalConfig.html">Models.WorkbookLocalConfig</a></li>
                                <li><a href="../classes/Property.html">Property</a></li>
                                <li><a href="../classes/State.html">State</a></li>
                                <li><a href="../classes/State.define.html">State.define</a></li>
                                <li><a href="../classes/ViewModels.AccountMenu.html">ViewModels.AccountMenu</a></li>
                                <li><a href="../classes/ViewModels.AddressRelation.html">ViewModels.AddressRelation</a></li>
                                <li><a href="../classes/ViewModels.AutoNumber.html">ViewModels.AutoNumber</a></li>
                                <li><a href="../classes/ViewModels.Button.html">ViewModels.Button</a></li>
                                <li><a href="../classes/ViewModels.Checkbox.html">ViewModels.Checkbox</a></li>
                                <li><a href="../classes/ViewModels.ChildFormPage.html">ViewModels.ChildFormPage</a></li>
                                <li><a href="../classes/ViewModels.ChildTable.html">ViewModels.ChildTable</a></li>
                                <li><a href="../classes/ViewModels.ContactRelation.html">ViewModels.ContactRelation</a></li>
                                <li><a href="../classes/ViewModels.DataList.html">ViewModels.DataList</a></li>
                                <li><a href="../classes/ViewModels.DataType.html">ViewModels.DataType</a></li>
                                <li><a href="../classes/ViewModels.Dialog.html">ViewModels.Dialog</a></li>
                                <li><a href="../classes/ViewModels.FilterDialog.html">ViewModels.FilterDialog</a></li>
                                <li><a href="../classes/ViewModels.FormDialog.html">ViewModels.FormDialog</a></li>
                                <li><a href="../classes/ViewModels.FormPage.html">ViewModels.FormPage</a></li>
                                <li><a href="../classes/ViewModels.FormWidget.html">ViewModels.FormWidget</a></li>
                                <li><a href="../classes/ViewModels.MoneyRelation.html">ViewModels.MoneyRelation</a></li>
                                <li><a href="../classes/ViewModels.NavigatorMenu.html">ViewModels.NavigatorMenu</a></li>
                                <li><a href="../classes/ViewModels.RelationWidget.html">ViewModels.RelationWidget</a></li>
                                <li><a href="../classes/ViewModels.SearchInput.html">ViewModels.SearchInput</a></li>
                                <li><a href="../classes/ViewModels.SearchPage.html">ViewModels.SearchPage</a></li>
                                <li><a href="../classes/ViewModels.SettingsPage.html">ViewModels.SettingsPage</a></li>
                                <li><a href="../classes/ViewModels.SortDialog.html">ViewModels.SortDialog</a></li>
                                <li><a href="../classes/ViewModels.TableDialog.html">ViewModels.TableDialog</a></li>
                                <li><a href="../classes/ViewModels.TableWidget.html">ViewModels.TableWidget</a></li>
                                <li><a href="../classes/ViewModels.WorkbookPage.html">ViewModels.WorkbookPage</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/AccountMenu.html">AccountMenu</a></li>
                                <li><a href="../modules/AddressRelation.html">AddressRelation</a></li>
                                <li><a href="../modules/AutoNumber.html">AutoNumber</a></li>
                                <li><a href="../modules/Button.html">Button</a></li>
                                <li><a href="../modules/Catalog.html">Catalog</a></li>
                                <li><a href="../modules/Checkbox.html">Checkbox</a></li>
                                <li><a href="../modules/ChildFormPage.html">ChildFormPage</a></li>
                                <li><a href="../modules/ChildTable.html">ChildTable</a></li>
                                <li><a href="../modules/ContactRelation.html">ContactRelation</a></li>
                                <li><a href="../modules/Core.html">Core</a></li>
                                <li><a href="../modules/DataList.html">DataList</a></li>
                                <li><a href="../modules/Datasource.html">Datasource</a></li>
                                <li><a href="../modules/DataType.html">DataType</a></li>
                                <li><a href="../modules/Dialog.html">Dialog</a></li>
                                <li><a href="../modules/FilterDialog.html">FilterDialog</a></li>
                                <li><a href="../modules/FormDialog.html">FormDialog</a></li>
                                <li><a href="../modules/FormPage.html">FormPage</a></li>
                                <li><a href="../modules/FormWidget.html">FormWidget</a></li>
                                <li><a href="../modules/List.html">List</a></li>
                                <li><a href="../modules/Model.html">Model</a></li>
                                <li><a href="../modules/MoneyRelation.html">MoneyRelation</a></li>
                                <li><a href="../modules/NavigatorMenu.html">NavigatorMenu</a></li>
                                <li><a href="../modules/Property.html">Property</a></li>
                                <li><a href="../modules/RelationWidget.html">RelationWidget</a></li>
                                <li><a href="../modules/SearchInput.html">SearchInput</a></li>
                                <li><a href="../modules/SearchPage.html">SearchPage</a></li>
                                <li><a href="../modules/SettingsPage.html">SettingsPage</a></li>
                                <li><a href="../modules/SortDialog.html">SortDialog</a></li>
                                <li><a href="../modules/State.html">State</a></li>
                                <li><a href="../modules/TableDialog.html">TableDialog</a></li>
                                <li><a href="../modules/TableWidget.html">TableWidget</a></li>
                                <li><a href="../modules/Workbook.html">Workbook</a></li>
                                <li><a href="../modules/WorkbookPage.html">WorkbookPage</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: components\form-widget.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/*
    Framework for building object relational database apps
    Copyright (C) 2019  John Rogelstad

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
*/
/*jslint this, browser*/
/**
    @module FormWidget
*/
import f from &quot;../core.js&quot;;

const catalog = f.catalog();
const formWidget = {};
const m = window.m;
const console = window.console;

function buildButtons(vm) {
    let ret;
    let className;
    let lonelyTabClass = [
        &quot;pure-button&quot;,
        &quot;fb-group-tab&quot;,
        &quot;fb-group-tab-form&quot;
    ];
    let midTabClass = f.copy(lonelyTabClass);
    let leftTabClass = f.copy(lonelyTabClass);
    let rightTabClass = f.copy(lonelyTabClass);
    let tabs = vm.config().tabs || [];
    let last = tabs.length - 1;

    tabs = tabs.map((tab) =&gt; tab.name);

    if (tabs.length &gt; 1) {
        midTabClass.push(&quot;fb-group-tab-middle&quot;);
        leftTabClass.push(&quot;fb-group-tab-left&quot;);
        rightTabClass.push(&quot;fb-group-tab-right&quot;);

        ret = tabs.map(function (name, idx) {
            switch (idx) {
            case 0:
                className = leftTabClass;
                break;
            case last:
                className = rightTabClass;
                break;
            default:
                className = f.copy(midTabClass);
            }

            if (idx + 1 === vm.selectedTab()) {
                className.push(&quot;fb-group-tab-active&quot;);
            }

            return m(&quot;button&quot;, {
                class: className.join(&quot; &quot;),
                onclick: vm.selectedTab.bind(null, idx + 1)
            }, name);
        });
        // One button only gets all four corners rounded
    } else {
        lonelyTabClass.push(&quot;fb-group-tab-lonely&quot;);
        lonelyTabClass.push(&quot;fb-group-tab-active&quot;);

        return m(&quot;button&quot;, {
            class: lonelyTabClass.join(&quot; &quot;),
            onclick: vm.selectedTab.bind(null, 1)
        }, tabs[0]);
    }

    return ret;
}

function buildFieldset(vm, attrs) {
    return attrs.map(function (item) {
        let result;
        let labelOpts;
        let label;
        let key = item.attr;
        let model = vm.model();
        let prop = model.data[key];
        if (!prop) {
            console.error(&quot;Unknown attribute &quot; + key + &quot; in form&quot;);
            return;
        }
        let dataList = item.dataList || prop.dataList;
        let value = prop();
        let options = {
            height: item.height
        };
        let menuButtons = vm.menuButtons();
        let relation = vm.relations()[key];

        function openMenuClass() {
            let ret = &quot;pure-menu-link fb-form-label-menu-item&quot;;

            if (relation &amp;&amp; relation.model &amp;&amp; !relation.model()) {
                ret += &quot; pure-menu-disabled&quot;;
            }

            return ret;
        }

        function editMenuClass() {
            let ret = &quot;pure-menu-link fb-form-label-menu-item&quot;;

            if (
                relation &amp;&amp; relation.isReadOnly &amp;&amp;
                relation.isReadOnly()
            ) {
                ret += &quot; pure-menu-disabled&quot;;
            }

            return ret;
        }

        options.disableCurrency = item.disableCurrency;

        if (dataList) {
            // If reference a property, get the property
            if (typeof dataList === &quot;string&quot;) {
                dataList = model.data[dataList]();

            // Must referencoe a simple array, transform
            } else if (typeof dataList[0] !== &quot;object&quot;) {
                dataList = dataList.map(function (item) {
                    return {value: item, label: item};
                });
            }
        }

        labelOpts = {
            for: key,
            class: &quot;fb-form-label&quot;,
            style: {},
            title: prop.description
        };

        // For relations we get buttons for label
        if (relation &amp;&amp; relation.isRelationWidget) {
            if (!menuButtons[key]) {
                menuButtons[key] = {
                    display: &quot;none&quot;
                };
            }

            labelOpts.class = &quot;pure-button fb-form-label-button&quot;;
            labelOpts.onclick = function () {
                menuButtons[key].display = &quot;block&quot;;
            };
            labelOpts.onmouseout = function (ev) {
                if (
                    !ev || !ev.toElement ||
                    !ev.toElement.id ||
                    ev.toElement.id.indexOf(
                        &quot;nav-relation&quot;
                    ) === -1
                ) {
                    menuButtons[key].display = &quot;none&quot;;
                }
            };
            label = m(&quot;div&quot;, labelOpts, [
                m(&quot;div&quot;, {
                    id: &quot;nav-relation-div-&quot; + key,
                    class: &quot;pure-menu fb-relation-menu&quot;
                }, [
                    m(&quot;ul&quot;, {
                        class: &quot;pure-menu-list fb-relation-menu-list&quot;,
                        id: &quot;nav-relation-list-&quot; + key,
                        style: {
                            top: &quot;27px&quot;,
                            display: menuButtons[key].display
                        }
                    }, [
                        m(&quot;li&quot;, {
                            id: &quot;nav-relation-search-&quot; + key,
                            class: editMenuClass(),
                            onclick: relation.search
                        }, [m(&quot;i&quot;, {
                            id: &quot;nav-relation-search-icon-&quot; + key,
                            class: &quot;fa fa-search&quot;
                        })], &quot; Search&quot;),
                        m(&quot;li&quot;, {
                            id: &quot;nav-relation-open-&quot; + key,
                            class: openMenuClass(),
                            onclick: relation.open
                        }, [m(&quot;i&quot;, {
                            id: &quot;nav-relation-open-icon-&quot; + key,
                            class: &quot;fa fa-folder-open&quot;
                        })], &quot; Open&quot;),
                        m(&quot;li&quot;, {
                            id: &quot;nav-relation-new-&quot; + key,
                            class: editMenuClass(),
                            onclick: relation.new
                        }, [m(&quot;i&quot;, {
                            id: &quot;nav-relation-new-icon-&quot; + key,
                            class: &quot;fa fa-plus-circle&quot;
                        })], &quot; New&quot;)
                    ])
                ]),
                m(&quot;i&quot;, {
                    class: &quot;fa fa-bars&quot;,
                    style: {
                        marginRight: &quot;4px&quot;
                    }
                })
            ], item.label || prop.alias() + &quot;:&quot;);
        } else {
            label = m(&quot;label&quot;, labelOpts, item.label || prop.alias() + &quot;:&quot;);
        }

        if (item.showLabel === false) {
            labelOpts.style.display = &quot;none&quot;;
        }

        if (!prop.isReadOnly() &amp;&amp; !vm.focusAttr()) {
            vm.focusAttr(key);
        }

        if (vm.focusAttr() === key) {
            options.oncreate = function (vnode) {
                document.getElementById(vnode.dom.id).focus();
            };
        }

        if (
            prop.isRequired() &amp;&amp; (
                value === null || (prop.type === &quot;string&quot; &amp;&amp; !value)
            )
        ) {
            labelOpts.style.color = &quot;Red&quot;;
        }
        result = m(&quot;div&quot;, {
            class: &quot;pure-control-group&quot;
        }, [
            label,
            f.createEditor({
                model: model,
                key: key,
                dataList: dataList,
                filter: item.filter,
                viewModel: vm,
                options: options,
                widget: item.relationWidget
            })
        ]);
        return result;
    });
}

function resize(vm, vnode) {
    let e = document.getElementById(vnode.dom.id);
    let bodyHeight = window.innerHeight;
    let eids = vm.outsideElementIds();

    eids.forEach(function (id) {
        let h = document.getElementById(id).clientHeight;
        bodyHeight = bodyHeight.minus(h);
    });

    e.style.maxHeight = bodyHeight - 5 + &quot;px&quot;;
}

function buildUnit(vm, attrs, n) {
    let fieldset = buildFieldset(vm, attrs);

    return m(&quot;div&quot;, {
        class: &quot;pure-u-1 pure-u-md-1-&quot; + n
    }, [
        m(&quot;div&quot;, {
            class: &quot;pure-form pure-form-aligned&quot;
        }, [m(&quot;fieldset&quot;, fieldset)])
    ]);
}

function buildGrid(grid, idx) {
    let units;
    let vm = this;
    let className = &quot;fb-tabbed-panes fb-tabbed-panes-form&quot;;

    units = grid.map(function (unit) {
        return buildUnit(vm, unit, grid.length);
    });

    if (!idx) {
        return m(&quot;div&quot;, {
            class: &quot;pure-g fb-top-pane&quot;
        }, units);
    }

    if (idx !== vm.selectedTab()) {
        className += &quot; fb-tabbed-panes-hidden&quot;;
    }

    return m(&quot;div&quot;, {
        class: className
    }, [
        buildButtons(vm),
        m(&quot;div&quot;, {
            class: &quot;pure-g fb-tabbed-pane&quot;
        }, units)
    ]);
}

/**
    @class FormWidget
    @constructor
    @namespace ViewModels
    @param {Object} options
    @param {Object} [options.config] Layout configuration
    @param {String} [options.config.focus] Focus attribute
    @param {String} [options.containerId]
    @param {String} [options.isScrollable]
    @param {Array} [options.outsideElementIds]
*/
formWidget.viewModel = function (options) {
    let model;
    let modelState;
    let vm = {};

    /**
        Layout configuration.
        @method config
        @param {Object} [config]
        @return {Object}
    */
    vm.config = f.prop(options.config);
    /**
        @method containerId
        @param {String} [id]
        @return {String}
    */
    vm.containerId = f.prop(options.containerId);
    /**
        @method errorDialog
        @param {ViewModels.Dialog} [dialog]
        @return {ViewModels.Dialog}
    */
    vm.errorDialog = f.prop(f.createViewModel(&quot;Dialog&quot;, {
        icon: &quot;exclamation-circle&quot;,
        title: &quot;Error&quot;
    }));
    vm.errorDialog().buttonCancel().hide();
    /**
        @method isScrollable
        @param {Boolean} [flag]
        @return {Boolean}
    */
    vm.isScrollable = f.prop(options.isScrollable !== false);
    /**
        @method focusAttr
        @param {String} [attr]
        @return {String}
    */
    vm.focusAttr = f.prop(options.config.focus);
    /**
        @method menuButtons
        @param {Array} [buttons]
        @return {Array}
    */
    vm.menuButtons = f.prop({});
    /**
        @method selectedTab
        @param {Integer} [index]
        @return {Integer}
    */
    vm.selectedTab = f.prop(1);
    /**
        @method model
        @param {Model} [model]
        @return {Model}
    */
    vm.model = f.prop();
    /**
        @method outsideElementIds
        @param {String} [id]
        @return {String}
    */
    vm.outsideElementIds = f.prop(options.outsideElementIds || []);

    /**
        Places to store relation content between redraws
        @method relations
        @param {Object} [relations]
        @return {Object}
    */
    vm.relations = f.prop({});
    /**
        Places to store selector components between redraws
        @method selectComponents
        @param {Object} [components]
        @return {Object}
    */
    vm.selectComponents = f.prop({});

    // ..........................................................
    // PRIVATE
    //
    if (typeof options.model === &quot;object&quot;) {
        vm.model(options.model);
    } else {
        model = vm.model(f.createModel(
            options.model.toCamelCase(true)
        ));
        if (options.id) {
            model.id(options.id);
            if (!options.isNew) {
                model.fetch();
                model.checkUpdate();
            }
        }
    }

    // Bind model state to error event
    modelState = vm.model().state();
    modelState.resolve(&quot;/Ready&quot;).enter(function () {
        let err = vm.model().lastError();

        if (err) {
            vm.errorDialog().message(err.message);
            vm.errorDialog().show();
        }
    });

    // Subscribe to external events
    vm.model().subscribe(true);

    return vm;
};

catalog.register(&quot;viewModels&quot;, &quot;formWidget&quot;, formWidget.viewModel);

/**
    @class FormWidget
    @static
    @namespace Components
*/
formWidget.component = {
    /**
        Pass either &#x60;vnode.attrs.viewModel&#x60; or &#x60;vnode.attrs&#x60; with options
        to build view model.

        @method oninit
        @param {Object} vnode Virtual node
        @param {Object} vnode.attrs
        @param {Object} vnode.attrs.viewModel
    */
    oninit: function (vnode) {
        this.viewModel = vnode.attrs.viewModel;
    },

    /**
        Makes sure subscriptions are ceased when done.
        @method onremove
    */
    onremove: function () {
        // Unsubscribe model when we&#x27;re done here
        this.viewModel.model().subscribe(false);
    },

    /**
        @method view
        @param {Object} vnode Virtual node
        @return {Object} View
    */
    view: function (vnode) {
        let vm = vnode.attrs.viewModel;
        let attrs = vm.config().attrs || [];
        let model = vm.model();
        let grids = [];

        // build grid matrix from inside out
        attrs.forEach(function (item) {
            let gidx = item.grid || 0;
            let uidx = item.unit || 0;
            if (!grids[gidx]) {
                grids[gidx] = [];
            }
            if (!grids[gidx][uidx]) {
                grids[gidx][uidx] = [];
            }
            grids[gidx][uidx].push(item);
        });

        // Build pane content
        grids = grids.map(buildGrid.bind(vm));

        grids.unshift(m(f.getComponent(&quot;Dialog&quot;), {
            viewModel: vm.errorDialog()
        }));

        return m(&quot;div&quot;, {
            id: model.id(),
            class: (
                vm.isScrollable()
                ? &quot;fb-form-content&quot;
                : &quot;&quot;
            ),
            oncreate: resize.bind(null, vm),
            onupdate: resize.bind(null, vm)
        }, grids);
    }
};

catalog.register(&quot;components&quot;, &quot;formWidget&quot;, formWidget.component);

export default Object.freeze(formWidget);
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
