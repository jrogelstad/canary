<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>models\workbook.js - Featherbone Client</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="..\..\featherbone-client.png" title="Featherbone Client"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Catalog.html">Catalog</a></li>
                                <li><a href="../classes/Components.AccountMenu.html">Components.AccountMenu</a></li>
                                <li><a href="../classes/Components.AddressRelation.html">Components.AddressRelation</a></li>
                                <li><a href="../classes/Components.AutoNumber.html">Components.AutoNumber</a></li>
                                <li><a href="../classes/Components.Button.html">Components.Button</a></li>
                                <li><a href="../classes/Components.Checkbox.html">Components.Checkbox</a></li>
                                <li><a href="../classes/Components.ChildFormPage.html">Components.ChildFormPage</a></li>
                                <li><a href="../classes/Components.ChildTable.html">Components.ChildTable</a></li>
                                <li><a href="../classes/Components.ContactRelation.html">Components.ContactRelation</a></li>
                                <li><a href="../classes/Components.DataList.html">Components.DataList</a></li>
                                <li><a href="../classes/Components.DataType.html">Components.DataType</a></li>
                                <li><a href="../classes/Components.Dialog.html">Components.Dialog</a></li>
                                <li><a href="../classes/Components.FilterDialog.html">Components.FilterDialog</a></li>
                                <li><a href="../classes/Components.FormDialog.html">Components.FormDialog</a></li>
                                <li><a href="../classes/Components.FormPage.html">Components.FormPage</a></li>
                                <li><a href="../classes/Components.FormWidget.html">Components.FormWidget</a></li>
                                <li><a href="../classes/Components.MoneyRelation.html">Components.MoneyRelation</a></li>
                                <li><a href="../classes/Components.NavigatorMenu.html">Components.NavigatorMenu</a></li>
                                <li><a href="../classes/Components.RelationWidget.html">Components.RelationWidget</a></li>
                                <li><a href="../classes/Components.SearchInput.html">Components.SearchInput</a></li>
                                <li><a href="../classes/Components.SearchPage.html">Components.SearchPage</a></li>
                                <li><a href="../classes/Components.SettingsPage.html">Components.SettingsPage</a></li>
                                <li><a href="../classes/Components.SortDialog.html">Components.SortDialog</a></li>
                                <li><a href="../classes/Components.TableDialog.html">Components.TableDialog</a></li>
                                <li><a href="../classes/Components.TableWidget.html">Components.TableWidget</a></li>
                                <li><a href="../classes/Components.WorkbookPage.html">Components.WorkbookPage</a></li>
                                <li><a href="../classes/Datasource.html">Datasource</a></li>
                                <li><a href="../classes/f.html">f</a></li>
                                <li><a href="../classes/List.html">List</a></li>
                                <li><a href="../classes/Model.html">Model</a></li>
                                <li><a href="../classes/Models.Address.html">Models.Address</a></li>
                                <li><a href="../classes/Models.BaseCurrency.html">Models.BaseCurrency</a></li>
                                <li><a href="../classes/Models.Comment.html">Models.Comment</a></li>
                                <li><a href="../classes/Models.Contact.html">Models.Contact</a></li>
                                <li><a href="../classes/Models.ContactAddress.html">Models.ContactAddress</a></li>
                                <li><a href="../classes/Models.ContactEmail.html">Models.ContactEmail</a></li>
                                <li><a href="../classes/Models.ContactPhone.html">Models.ContactPhone</a></li>
                                <li><a href="../classes/Models.ContactSocialAccount.html">Models.ContactSocialAccount</a></li>
                                <li><a href="../classes/Models.Country.html">Models.Country</a></li>
                                <li><a href="../classes/Models.Currency.html">Models.Currency</a></li>
                                <li><a href="../classes/Models.CurrencyConversion.html">Models.CurrencyConversion</a></li>
                                <li><a href="../classes/Models.CurrencyUnit.html">Models.CurrencyUnit</a></li>
                                <li><a href="../classes/Models.CurrencyUnitConversion.html">Models.CurrencyUnitConversion</a></li>
                                <li><a href="../classes/Models.DataListOption.html">Models.DataListOption</a></li>
                                <li><a href="../classes/Models.DataService.html">Models.DataService</a></li>
                                <li><a href="../classes/Models.Document.html">Models.Document</a></li>
                                <li><a href="../classes/Models.Feather.html">Models.Feather</a></li>
                                <li><a href="../classes/Models.FeatherAuthorization.html">Models.FeatherAuthorization</a></li>
                                <li><a href="../classes/Models.FeatherOverload.html">Models.FeatherOverload</a></li>
                                <li><a href="../classes/Models.FeatherProperty.html">Models.FeatherProperty</a></li>
                                <li><a href="../classes/Models.Form.html">Models.Form</a></li>
                                <li><a href="../classes/Models.FormAttr.html">Models.FormAttr</a></li>
                                <li><a href="../classes/Models.FormAttrColumn.html">Models.FormAttrColumn</a></li>
                                <li><a href="../classes/Models.FormTab.html">Models.FormTab</a></li>
                                <li><a href="../classes/Models.Honorific.html">Models.Honorific</a></li>
                                <li><a href="../classes/Models.Kind.html">Models.Kind</a></li>
                                <li><a href="../classes/Models.Layout.html">Models.Layout</a></li>
                                <li><a href="../classes/Models.Log.html">Models.Log</a></li>
                                <li><a href="../classes/Models.Module.html">Models.Module</a></li>
                                <li><a href="../classes/Models.ModuleDependency.html">Models.ModuleDependency</a></li>
                                <li><a href="../classes/Models.Object.html">Models.Object</a></li>
                                <li><a href="../classes/Models.ObjectAuthorization.html">Models.ObjectAuthorization</a></li>
                                <li><a href="../classes/Models.RelationSearchColumn.html">Models.RelationSearchColumn</a></li>
                                <li><a href="../classes/Models.RelationWidget.html">Models.RelationWidget</a></li>
                                <li><a href="../classes/Models.Role.html">Models.Role</a></li>
                                <li><a href="../classes/Models.RoleMembership.html">Models.RoleMembership</a></li>
                                <li><a href="../classes/Models.Route.html">Models.Route</a></li>
                                <li><a href="../classes/Models.Script.html">Models.Script</a></li>
                                <li><a href="../classes/Models.SocialNetwork.html">Models.SocialNetwork</a></li>
                                <li><a href="../classes/Models.State.html">Models.State</a></li>
                                <li><a href="../classes/Models.Style.html">Models.Style</a></li>
                                <li><a href="../classes/Models.Unit.html">Models.Unit</a></li>
                                <li><a href="../classes/Models.UserAccount.html">Models.UserAccount</a></li>
                                <li><a href="../classes/Models.Workbook.html">Models.Workbook</a></li>
                                <li><a href="../classes/Models.WorkbookAuthorization.html">Models.WorkbookAuthorization</a></li>
                                <li><a href="../classes/Models.WorkbookChild.html">Models.WorkbookChild</a></li>
                                <li><a href="../classes/Models.WorkbookDefaultConfig.html">Models.WorkbookDefaultConfig</a></li>
                                <li><a href="../classes/Models.WorkbookLocalConfig.html">Models.WorkbookLocalConfig</a></li>
                                <li><a href="../classes/Property.html">Property</a></li>
                                <li><a href="../classes/State.html">State</a></li>
                                <li><a href="../classes/State.define.html">State.define</a></li>
                                <li><a href="../classes/ViewModels.AccountMenu.html">ViewModels.AccountMenu</a></li>
                                <li><a href="../classes/ViewModels.AddressRelation.html">ViewModels.AddressRelation</a></li>
                                <li><a href="../classes/ViewModels.AutoNumber.html">ViewModels.AutoNumber</a></li>
                                <li><a href="../classes/ViewModels.Button.html">ViewModels.Button</a></li>
                                <li><a href="../classes/ViewModels.Checkbox.html">ViewModels.Checkbox</a></li>
                                <li><a href="../classes/ViewModels.ChildFormPage.html">ViewModels.ChildFormPage</a></li>
                                <li><a href="../classes/ViewModels.ChildTable.html">ViewModels.ChildTable</a></li>
                                <li><a href="../classes/ViewModels.ContactRelation.html">ViewModels.ContactRelation</a></li>
                                <li><a href="../classes/ViewModels.DataList.html">ViewModels.DataList</a></li>
                                <li><a href="../classes/ViewModels.DataType.html">ViewModels.DataType</a></li>
                                <li><a href="../classes/ViewModels.Dialog.html">ViewModels.Dialog</a></li>
                                <li><a href="../classes/ViewModels.FilterDialog.html">ViewModels.FilterDialog</a></li>
                                <li><a href="../classes/ViewModels.FormDialog.html">ViewModels.FormDialog</a></li>
                                <li><a href="../classes/ViewModels.FormPage.html">ViewModels.FormPage</a></li>
                                <li><a href="../classes/ViewModels.FormWidget.html">ViewModels.FormWidget</a></li>
                                <li><a href="../classes/ViewModels.MoneyRelation.html">ViewModels.MoneyRelation</a></li>
                                <li><a href="../classes/ViewModels.NavigatorMenu.html">ViewModels.NavigatorMenu</a></li>
                                <li><a href="../classes/ViewModels.RelationWidget.html">ViewModels.RelationWidget</a></li>
                                <li><a href="../classes/ViewModels.SearchInput.html">ViewModels.SearchInput</a></li>
                                <li><a href="../classes/ViewModels.SearchPage.html">ViewModels.SearchPage</a></li>
                                <li><a href="../classes/ViewModels.SettingsPage.html">ViewModels.SettingsPage</a></li>
                                <li><a href="../classes/ViewModels.SortDialog.html">ViewModels.SortDialog</a></li>
                                <li><a href="../classes/ViewModels.TableDialog.html">ViewModels.TableDialog</a></li>
                                <li><a href="../classes/ViewModels.TableWidget.html">ViewModels.TableWidget</a></li>
                                <li><a href="../classes/ViewModels.WorkbookPage.html">ViewModels.WorkbookPage</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/AccountMenu.html">AccountMenu</a></li>
                                <li><a href="../modules/AddressRelation.html">AddressRelation</a></li>
                                <li><a href="../modules/AutoNumber.html">AutoNumber</a></li>
                                <li><a href="../modules/Button.html">Button</a></li>
                                <li><a href="../modules/Catalog.html">Catalog</a></li>
                                <li><a href="../modules/Checkbox.html">Checkbox</a></li>
                                <li><a href="../modules/ChildFormPage.html">ChildFormPage</a></li>
                                <li><a href="../modules/ChildTable.html">ChildTable</a></li>
                                <li><a href="../modules/ContactRelation.html">ContactRelation</a></li>
                                <li><a href="../modules/Core.html">Core</a></li>
                                <li><a href="../modules/DataList.html">DataList</a></li>
                                <li><a href="../modules/Datasource.html">Datasource</a></li>
                                <li><a href="../modules/DataType.html">DataType</a></li>
                                <li><a href="../modules/Dialog.html">Dialog</a></li>
                                <li><a href="../modules/FilterDialog.html">FilterDialog</a></li>
                                <li><a href="../modules/FormDialog.html">FormDialog</a></li>
                                <li><a href="../modules/FormPage.html">FormPage</a></li>
                                <li><a href="../modules/FormWidget.html">FormWidget</a></li>
                                <li><a href="../modules/List.html">List</a></li>
                                <li><a href="../modules/Model.html">Model</a></li>
                                <li><a href="../modules/MoneyRelation.html">MoneyRelation</a></li>
                                <li><a href="../modules/NavigatorMenu.html">NavigatorMenu</a></li>
                                <li><a href="../modules/Property.html">Property</a></li>
                                <li><a href="../modules/RelationWidget.html">RelationWidget</a></li>
                                <li><a href="../modules/SearchInput.html">SearchInput</a></li>
                                <li><a href="../modules/SearchPage.html">SearchPage</a></li>
                                <li><a href="../modules/SettingsPage.html">SettingsPage</a></li>
                                <li><a href="../modules/SortDialog.html">SortDialog</a></li>
                                <li><a href="../modules/State.html">State</a></li>
                                <li><a href="../modules/TableDialog.html">TableDialog</a></li>
                                <li><a href="../modules/TableWidget.html">TableWidget</a></li>
                                <li><a href="../modules/Workbook.html">Workbook</a></li>
                                <li><a href="../modules/WorkbookPage.html">WorkbookPage</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: models\workbook.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/*
    Framework for building object relational database apps
    Copyright (C) 2019  John Rogelstad

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU Affero General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU Affero General Public License for more details.

    You should have received a copy of the GNU Affero General Public License
    along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
*/
/*jslint this*/
import f from &quot;../core.js&quot;;
import datasource from &quot;../datasource.js&quot;;
import catalog from &quot;./catalog.js&quot;;

let models;
let feathers;
let descr = &quot;Parent of \&quot;parent\&quot; on \&quot;WorkbookDefaultConfig\&quot;&quot;;

/**
    @module Workbook
*/
const workbook = {
    name: &quot;Workbook&quot;,
    plural: &quot;Workbooks&quot;,
    description: &quot;System workbook definition&quot;,
    isSystem: true,
    properties: {
        name: {
            description: &quot;Workbook name&quot;,
            type: &quot;string&quot;
        },
        description: {
            description: &quot;Description&quot;,
            type: &quot;string&quot;
        },
        module: {
            description: &quot;Module&quot;,
            type: &quot;string&quot;
        },
        icon: {
            description: &quot;Menu icon&quot;,
            type: &quot;string&quot;,
            default: &quot;folder&quot;
        },
        launchConfig: {
            description: &quot;Launch configuration&quot;,
            type: &quot;object&quot;
        },
        defaultConfig: {
            description: descr,
            type: &quot;object&quot;
        },
        localConfig: {
            description: &quot;Parent of \&quot;parent\&quot; on \&quot;WorkbookLocalConfig\&quot;&quot;,
            type: &quot;object&quot;
        },
        authorizations: {
            description: &quot;Parent of \&quot;parent\&quot; on \&quot;WorkbookAuthorization\&quot;&quot;,
            type: {
                parentOf: &quot;parent&quot;,
                relation: &quot;WorkbookAuthorization&quot;
            }
        }
    }
};

const workbookDefaultConifg = {
    description: &quot;Workbook default sheet definition&quot;,
    isSystem: true,
    isChild: true,
    properties: {
        id: {
            description: &quot;Unique identifier&quot;,
            type: &quot;string&quot;,
            default: &quot;createId&quot;
        },
        parent: {
            description: &quot;Workbook parent&quot;,
            type: {
                relation: &quot;Workbook&quot;,
                childOf: &quot;defaultConfig&quot;
            }
        },
        name: {
            description: &quot;Sheet name&quot;,
            type: &quot;string&quot;,
            isRequired: true
        },
        feather: {
            description: &quot;Description&quot;,
            type: &quot;string&quot;,
            isRequired: true
        },
        form: {
            description: &quot;Form layout&quot;,
            type: {
                relation: &quot;Form&quot;
            }
        },
        list: {
            description: &quot;List layout&quot;,
            type: &quot;object&quot;
        },
        zoom: {
            description: &quot;Zoom level&quot;,
            type: &quot;string&quot;,
            default: &quot;100&quot;
        },
        isEditModeEnabled: {
            description: &quot;Flags whether inline editing is allowed&quot;,
            type: &quot;boolean&quot;,
            default: true
        },
        openInNewWindow: {
            description: &quot;Open record in a new tab window&quot;,
            type: &quot;boolean&quot;,
            default: false
        },
        actions: {
            description: &quot;Menu actions that can be performed on rows&quot;,
            type: &quot;object&quot;,
            default: []
        }
    }
};

const workbookList = {
    description: &quot;Workbook list definition&quot;,
    isSystem: true,
    isChild: true,
    properties: {
        columns: {
            description: &quot;Columns&quot;,
            type: &quot;object&quot;
        },
        filter: {
            description: &quot;Filter&quot;,
            type: &quot;object&quot;
        }
    }
};

const workbookLocalConfig = f.copy(workbookDefaultConifg);

const workbookAuth = {
    description: &quot;Workbook authorization definition&quot;,
    isSystem: true,
    properties: {
        isDeleted: {
            description: &quot;Boilerplate&quot;,
            type: &quot;boolean&quot;,
            default: false
        },
        parent: {
            description: &quot;Workbook parent&quot;,
            type: {
                relation: &quot;Workbook&quot;,
                childOf: &quot;authorizations&quot;
            }
        },
        role: {
            description: &quot;Role&quot;,
            type: &quot;string&quot;,
            format: &quot;role&quot;
        },
        canRead: {
            description: &quot;User can use workbook&quot;,
            type: &quot;boolean&quot;,
            default: true
        },
        canUpdate: {
            description: (
                &quot;User can update definition and &quot; +
                &quot;share workbook changes&quot;
            ),
            type: &quot;boolean&quot;,
            default: false
        }
    }
};

workbookLocalConfig.description = &quot;Workbook local sheet definition&quot;;
workbookLocalConfig.properties.parent.type.childOf = &quot;localConfig&quot;;
workbookLocalConfig.properties.list = {
    description: &quot;Parent of \&quot;parent\&quot; on \&quot;WorkbookList\&quot;&quot;,
    type: {
        relation: &quot;WorkbookList&quot;
    }
};

feathers = catalog.store().feathers();
feathers.Workbook = workbook;
feathers.WorkbookDefaultConfig = workbookDefaultConifg;
feathers.WorkbookLocalConfig = workbookLocalConfig;
feathers.WorkbookList = workbookList;
feathers.WorkbookAuthorization = workbookAuth;

function resolveConfig(config) {
    config.forEach(function (sheet) {
        if (!sheet.id) {
            sheet.id = f.createId();
        }
        if (typeof sheet.form === &quot;string&quot; &amp;&amp; sheet.form.length) {
            sheet.form = catalog.store().data().forms().find(
                (form) =&gt; sheet.form === form.id
            );
        }
    });
}

/**
    Model with special rest API handling for Workbook saves.

    @class Workbook
    @static
    @namespace Models
    @extends Model
*/
function workbookModel(data) {
    let model;
    let state;
    let substate;
    let doPut;
    let modules = f.prop(catalog.store().data().modules());
    let canUpdate;
    let profileConfig;

    function save(promise) {
        this.goto(&quot;/Busy/Saving&quot;, {
            context: {
                promise: promise
            }
        });
    }

    // ..........................................................
    // PUBLIC
    //

    data = data || {};
    if (data.localConfig) {
        resolveConfig(data.localConfig);
    }
    if (data.defaultConfig) {
        resolveConfig(data.defaultConfig);
    }
    model = f.createModel(data, workbook);
    model.idProperty(&quot;name&quot;);

    model.path = function (name, id) {
        let ret = &quot;/&quot; + name.toSpinalCase();

        if (id) {
            ret += &quot;/&quot; + id;
        }
        return ret;
    };

    model.getConfig = function () {
        let d = model.data;
        let profile;

        if (profileConfig) {
            return profileConfig;
        }

        profile = catalog.store().data().profile();

        if (
            profile &amp;&amp;
            profile.data &amp;&amp;
            profile.data.workbooks &amp;&amp;
            profile.data.workbooks[d.name()]
        ) {
            profileConfig = f.copy(profile.data.workbooks[d.name()]);
            return profileConfig;
        }

        if (d.localConfig().length) {
            return d.localConfig();
        }

        return d.defaultConfig();
    };

    /**
        Datalist array of available modules.

        __Type:__ &#x60;Array&#x60;

        @property data.modules
        @type {Property}
    */
    model.addCalculated({
        name: &quot;modules&quot;,
        type: &quot;array&quot;,
        function: modules
    });

    model.canUpdate = () =&gt; canUpdate;

    model.checkUpdate = function () {
        if (model.state().current()[0] !== &quot;/Ready/Fetched/Clean&quot;) {
            return;
        }

        if (canUpdate === undefined) {
            model.state().goto(&quot;/Ready/Fetched/ReadOnly&quot;);
            model.isAuthorized(&quot;canUpdate&quot;).then(function (resp) {
                canUpdate = resp;

                if (canUpdate) {
                    model.state().goto(&quot;/Ready/Fetched/Clean&quot;);
                }
            });
        }
    };

    /**
        Check whether workbook is authorized to perform an action.

        Allowable actions: &#x60;canRead&#x60;, &#x60;canUpdate&#x60;

        @method isAuthorized
        @param {String} Action name
        @return {Object} Promise
    */
    model.isAuthorized = function (action) {
        return new Promise(function (resolve, reject) {
            let payload = {
                method: &quot;GET&quot;,
                path: &quot;/workbook/is-authorized/&quot; + model.id(),
                data: {
                    action: action
                }
            };

            datasource.request(payload).then(resolve).catch(reject);
        });
    };

    // ..........................................................
    // PRIVATE
    //

    doPut = function (context) {
        let cache = model.toJSON();
        let payload = {
            method: &quot;PUT&quot;,
            path: model.path(model.name, model.data.name()),
            data: cache
        };

        function callback() {
            state.send(&quot;fetched&quot;);
            context.promise.resolve(model.data);
        }

        if (model.isValid()) {
            datasource.request(payload).then(callback).catch(model.error);
        }
    };

    // Update statechart for modified behavior
    state = model.state();
    substate = state.resolve(&quot;/Busy/Saving&quot;);
    delete substate.substateMap.Posting;
    delete substate.substateMap.Patching;
    substate.substates.length = 0;
    substate.enter(doPut);
    substate = state.resolve(&quot;/Ready/New&quot;);
    substate.event(&quot;save&quot;, save.bind(substate));
    substate = state.resolve(&quot;/Ready/Fetched/Dirty&quot;);
    substate.event(&quot;save&quot;, save.bind(substate));
    substate = state.resolve(&quot;/Ready/Fetched/Clean&quot;);
    substate.event(&quot;changed&quot;, function () {
        this.goto(&quot;../Dirty&quot;);
    });
    substate = state.resolve(&quot;/Delete&quot;);
    substate.enters.shift();

    model.onLoad(function () {
        model.data.name.isReadOnly(true);
    });

    return model;
}
/**
    Unique identifier.

    __Type:__ &#x60;String&#x60;

    @property data.id
    @type Property
*/
/**
    Workbook name.

    __Type:__ &#x60;String&#x60;

    @property data.name
    @type Property
*/
/**
    Description.

    __Type:__ &#x60;String&#x60;

    @property data.description
    @type Property
*/
/**
    Icon.

    __Type:__ &#x60;String&#x60;

    @property data.icon
    @type Property
*/
/**
    Launch configuration.

    __Type:__ &#x60;Object&#x60;

    @property data.launchConfig
    @type Property
*/
/**
    Parent of &#x60;parent&#x60; on &#x60;WorkbookDefaultConfig&#x60;.

    __Type:__ &#x60;WorkbookDefaultConfig&#x60;

    @property data.defaultConfig
    @type Property
*/
/**
    Parent of &#x60;parent&#x60; on &#x60;WorkbookLocalConfig&#x60;.

    __Type:__ &#x60;WorkboookLocalConfig&#x60;

    @property data.localConfig
    @type Property
*/
/**
    Module.

    __Type:__ &#x60;String&#x60;

    @property data.module
    @type Property
*/

/**
    Workbook child configuration model.

    @class WorkbookChild
    @static
    @extends Model
*/
function workbookChild(data) {
    let model = f.createModel(data, workbookLocalConfig);

    model.onChanged(&quot;feather&quot;, function (property) {
        let id;
        let forms;
        let invalid;
        let feather;
        let value = property.newValue();
        let list = model.data.list();
        let columns = list.data.columns();
        let filter = list.data.filter();
        let sort = (
            filter
            ? filter.sort
            : false
        );
        let criteria = (
            filter
            ? filter.criteria
            : false
        );

        // When feather changes, automatically assign
        // the first available form.
        if (value) {
            forms = catalog.store().data().forms();
            // Copy to new array model has regular filter method
            forms = forms.slice(0, forms.length - 1);
            forms = forms.filter(
                (form) =&gt; form.feather === value
            ).sort(function (a, b) {
                if (a.data.name() &lt; b.data.name()) {
                    return -1;
                }
                return 1;
            });
            id = (
                forms.length
                ? forms[0].id
                : undefined
            );

            // Remove mismatched columns
            feather = catalog.getFeather(value);
            invalid = columns.filter(function (column) {
                return !feather.properties[column.attr];
            });
            invalid.forEach(function (item) {
                let idx = columns.indexOf(item);
                columns.splice(idx, 1);
            });

            // Remove mismatched sort
            if (sort) {
                invalid = sort.filter(function (item) {
                    return !feather.properties[item.property];
                });
                invalid.forEach(function (item) {
                    let idx = sort.indexOf(item);
                    sort.splice(idx, 1);
                });
            }

            // Remove mismatched criteria
            if (criteria) {
                invalid = criteria.filter(function (item) {
                    return !feather.properties[item.property];
                });
                invalid.forEach(function (item) {
                    let idx = criteria.indexOf(item);
                    criteria.splice(idx, 1);
                });
            }
        } else {
            columns.length = 0;
            Object.keys(filter).forEach(function (key) {
                delete filter[key];
            });
        }

        model.data.form(forms.find((row) =&gt; row.id === id));
    });

    model.onValidate(function () {
        let list = model.data.list();

        if (!list.data.columns().length) {
            throw &quot;List must include at least one column.&quot;;
        }
    });

    return model;
}
workbookChild.static = f.prop({});
workbookChild.calculated = f.prop({});
/**
    Workbook parent.

    __Type:__ &#x60;String&#x60;

    @property data.parent
    @type Property
*/
/**
    Sheet name.

    __Type:__ &#x60;String&#x60;

    @property data.names
    @type Property
*/
/**
    Feather.

    __Type:__ &#x60;String&#x60;

    @property data.feather
    @type Property
*/
/**
    Form layout.

    __Type:__ &#x60;String&#x60;

    @property data.form
    @type Property
*/
/**
    List layout.

    __Type:__ &#x60;Object&#x60;

    @property data.list
    @type Property
*/
/**
    Zooom level.

    __Type:__ &#x60;Integer&#x60;

    @property data.zoom
    @type Property
*/
/**
    Parent of &#x60;parent&#x60; on &#x60;WorkbookLocalConfig&#x60;.

    __Type:__ &#x60;WorkboookLocalConfig&#x60;

    @property data.localConfig
    @type Property
*/
/**
    Module.

    __Type:__ &#x60;String&#x60;

    @property data.module
    @type Property
*/
/**
    Flags whether inline editing is allowed.

    __Type:__ &#x60;Boolean&#x60;

    @property data.isEditModeEnabled
    @type Property
*/
/**
    Open record in a new tab window.

    __Type:__ &#x60;Boolean&#x60;

    @property data.openInNewWindow
    @type Property
*/
/**
    Menu actions that can be performed on rows.

    __Type:__ &#x60;Object&#x60;

    @property data.actions
    @type Property
*/
/**
    @class WorkbookDefaultConfig
    @extends Models.WorkbookChild
*/
/**
    @class WorkbookLocalConfig
    @extends Models.WorkbookChild
*/

/**
    Workbook authorization definition.

    @class WorkbookAuthorization
    @static
    @extends Model
*/
function workbookAuthorization(data) {
    let model = f.createModel(data, workbookAuth);

    model.idProperty(&quot;role&quot;);

    return model;
}
workbookAuthorization.static = f.prop({});
workbookAuthorization.calculated = f.prop({});
/**
    Workbook parent.

    __Type:__ &#x60;Models.Workbook&#x60;

    @property data.parent
    @type Property
*/
/**
    Role.

    __Type:__ &#x60;Models.Role&#x60;

    @property data.Role
    @type Property
*/
/**
    User can read workbook.

    __Type:__ &#x60;Boolean&#x60;

    @property data.canRead
    @type Property
*/
/**
    User can update definition share workbook changes.

    __Type:__ &#x60;Boolean&#x60;

    @property data.canUpdate
    @type Property
*/

workbookModel.static = f.prop({});
workbookModel.calculated = f.prop({});

models = catalog.store().models();
models.workbook = workbookModel;
models.workbookLocalConfig = workbookChild;
models.workbookAuthorization = workbookAuthorization;
Object.freeze(models.workbookLocalConfig);


    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
